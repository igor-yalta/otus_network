## Лабораторная работа. Настройка HSRP ##

![](https://github.com/svasornd/otus_network/blob/master/lab03/Lab03_1_1.png)

| Устройство  | Интерфейс   | IP адрес  | Маска подсети | Шлюз по умолчанию |
| ---------- | ------------| ----------| ------------ | ------------ |
|  R1 | e0/2  | 192.168.1.1 | 255.255.255.0 | - |
|  R1 | s1/1  | 10.1.1.1 | 255.255.255.252 | - |
|  R2 | s1/1  | 10.1.1.2 | 255.255.255.252 | - |
|  R2 | s0/1  | 10.2.2.2 | 255.255.255.252 | - |
|  R2 | Lo1  | 209.165.200.225 | 255.255.255.224 | - |
|  R3 | e0/2  | 192.168.1.3 | 255.255.255.0 | - |
|  R3 | s0/0  | 10.2.2.1 | 255.255.255.252 | - |
|  S1 | VLAN 1  | 192.168.1.11 | 255.255.255.0 | 192.168.1.1 |
|  S2 | VLAN 1  | 192.168.1.13 | 255.255.255.0 | 192.168.1.3 |
|  PC-A | NIC  | 192.168.1.31 | 255.255.255.0 | 192.168.1.1 |
|  PC-C | NIC  | 192.168.1.33 | 255.255.255.0 | 192.168.1.3 |


[Конфигурация R1](https://github.com/svasornd/otus_network/blob/master/lab03/config/R1.md)

[Конфигурация R2](https://github.com/svasornd/otus_network/blob/master/lab03/config/R2.md) 

[Конфигурация R3](https://github.com/svasornd/otus_network/blob/master/lab03/config/R3.md)

[Конфигурация S1](https://github.com/svasornd/otus_network/blob/master/lab03/config/S1.md)

[Конфигурация S3](https://github.com/svasornd/otus_network/blob/master/lab03/config/S3.md)

##### Необходимо получить ответ на ping-запросы с компьютера PC-A от каждого интерфейса на маршрутизаторах R1, R2 и R3, а также от компьютера PC-C. Удалось ли получить все ответы? #####

Да

#####  Необходимо получить ответ на ping-запросы с компьютера PC-C от каждого интерфейса на маршрутизаторах R1, R2 и R3, а также от компьютера PC-A. Удалось ли получить все ответы?  ##### 

Да


Пакеты от PC-A до 209.165.200.225

trace 209.165.200.225
trace to 209.165.200.225, 8 hops max, press Ctrl+C to stop
 1   192.168.1.1   0.485 ms  0.358 ms  0.325 ms
 2   *10.1.1.2   0.482 ms (ICMP type:3, code:3, Destination port unreachable) 


Пакеты от PC-C до 209.165.200.225

trace  209.165.200.225
trace to 209.165.200.225, 8 hops max, press Ctrl+C to stop
 1   192.168.1.3   0.359 ms  0.277 ms  0.354 ms
 2   *10.2.2.2   0.552 ms (ICMP type:3, code:3, Destination port unreachable)  *


##### Эхо-тестирования на PC-A и PC-C ##### 

При отключении интерфейса e0/1 на S1.  ping –t 209.165.200.225 перестали проходить ответы. После включения интерфейса, через 15 секунд связь востновилась. Тоже самое на PC-C

### Настройка HSRP на R1 и R3. ###

##### Какой маршрутизатор является активным?  ##### 

Активный марщрутизатор R1

##### Какой MAC-адрес используется для виртуального IP-адреса ##### 

Active virtual MAC address is 0000.0c9f.f001

##### Какой IP-адрес и приоритет используются для резервного маршрутизатора? ##### 

Приоритет 100(по умолчанию) IP-адрес 192.168.1.3

##### Измените адрес шлюза по умолчанию для PC-A, PC-C, S1 и S3. Какой адрес следует использовать? ##### 

адрес шлюза по умолчанию для PC-A, PC-C, S1 и S3 - 192.168.1.254

##### Проверьте новые настройки. Отправьте эхо-запрос с PC-A и с PC-C на loopback-адрес маршрутизатора R2. Успешно ли выполнены эхо-запросы?  ##### 

Успешно

##### Запустите сеанс эхо-тестирования на PC-A и разорвите соединение с коммутатором, подключенным к активному маршрутизатору HSRP (R1). ##### 

a.	В командной строке на PC-A введите команду ping –t для адреса 209.165.200.225 на маршрутизаторе R2. Убедитесь, что окно командной строки открыто.

b.	Во время отправки эхо-запроса отсоедините кабель Ethernet от интерфейса F0/5 на коммутаторе S1 или выключите интерфейс F0/5.

##### Что произошло с трафиком эхо-запросов? ##### 

Трафик не прервался при отключении порта. При обратном включении порта, трафик тоже не превался.

##### Какой маршрутизатор является активным?  ##### 

маршрутизатор R3 стал активным 

Ethernet0/2 Grp 1 state Standby -> Active

##### Повторно подключите кабель, соединяющий коммутатор и маршрутизатор, или включите интерфейс F0/5. Какой маршрутизатор теперь является активным?  ##### 

После включения порта, заработало приоритетное вытаснение. Стаус стал R1 стал Active  и она стал активным. А R3 стал резервным.

## Изменение приоритетов HSRP.  ##

##### Измените приоритет HSRP на 200 на маршрутизаторе R3. Какой маршрутизатор является активным?  ##### 

Активным остался маршрутизатор R1, он уже был активен. 

##### Выполните команду, чтобы сделать активным маршрутизатор R3 без изменения приоритета. Какую команду вы использовали? ##### 

Команда standby 1 preempt, для первыбора активного шлюза. После этого R3 стал активным.


### Вопросы для повторения ###

#### Для чего в локальной сети может потребоваться избыточность? ####

- для проведения работ по обслуживанию сегмента сети. 

- для резервирования шзюза по умолчанию, если оснвоной шлюз выйдет из строя.



## Лабораторная работа. Настройка EtherChannel ##

![](https://github.com/svasornd/otus_network/blob/master/lab03/Lab03_2.png)

| Устройство  | Интерфейс   | IP адрес  | Маска подсети |
| ---------- | ------------| ----------| ------------ |
|  S1 | VLAN 99  | 192.168.99.11 | 255.255.255.0 | 
|  S2 | VLAN 99  | 192.168.99.13 | 255.255.255.0 | 
|  S3 | VLAN 99  | 192.168.99.13 | 255.255.255.0 | 
|  PC-A | NIC  | 192.168.0.1 | 255.255.255.0 | 
|  PC-B | NIC  | 192.168.0.2 | 255.255.255.0 | 
|  PC-C | NIC  | 192.168.0.3 | 255.255.255.0 | 


[Конфигурация S1](https://github.com/svasornd/otus_network/blob/master/lab03/config/S1_01.md)

[Конфигурация S2](https://github.com/svasornd/otus_network/blob/master/lab03/config/S2_01.md)

[Конфигурация S3](https://github.com/svasornd/otus_network/blob/master/lab03/config/S3_01.md)



#### Выполните команды show run interface идентификатор-интерфейса на S1 и S3. Какие команды включены в список для интерфейсов F0/3 и F0/4 на обоих коммутаторах? Сравните результаты с текущей конфигурацией для интерфейса Po1. Запишите наблюдения. ####

*interface Port-channel1*

*switchport trunk encapsulation dot1q*

*switchport trunk native vlan 99*

*switchport mode trunk*

*interface Ethernet0/2*

 *switchport trunk encapsulation dot1q*
 
 *switchport trunk native vlan 99*
 
 *switchport mode trunk*
 
 *channel-group 1 mode desirable*

*interface Ethernet0/3*

 *switchport trunk encapsulation dot1q*
 
 *switchport trunk native vlan 99*
 
 *switchport mode trunk*
 
 *channel-group 1 mode desirable*

Конфигурация VLAN полность применилась на портав входящих в состав группы Port-channel1. Настройки Port-channel1 - автоматичкие применяются на портах входящих в группу.

#### Выполните команды show interfaces trunk и show spanning-tree на S1 и S3. Какой транковый порт включен в список? Какая используется сеть native VLAN? Какой вывод можно сделать на основе выходных данных? ###

Trunk порт всего 1. Port-channel1 и порт spanning-tree тоже Port-channel1. Порты Ethernet0/2 Ethernet0/3  в выводе отсутвуют, т.е. коммтуатор не воспринимает их как отдельные интерфейсы.

#### Какие значения стоимости и приоритета порта для агрегированного канала отображены в выходных данных команды show spanning-tree? ####

Стоимость 56   Приоритет  128.65 

### Часть 3:	Настройка протокола LACP ###

#### Какой протокол использует Po2 для агрегирования каналов? Какие порты агрегируются для образования Po2? Запишите команду, используемую для проверки. ####

Channel group 2 - использует Protocol = LACP

Агрегируются порты -  коммутатор S1 - Et0/0 и Et0/1, коммтуатор S2 - Et0/0 и Et0/1

Команды для проверки - 

*show interfaces etherchannel*

*show lacp internal*

#### Вопросы для повторения. Что может препятствовать образованию каналов EtherChannel?####

    Разная скорость интерфейсов, объединеных в одну группу
    Разный дуплексный режим
    Нахождение портов в группе в разных VLAN
    Разные vlan на магистральном канале



## Лабораторная работа. Поиск и устранение неполадок в работе EtherChannel ##

![](https://github.com/svasornd/otus_network/blob/master/lab03/Lab03_3.png)

| Устройство  | Интерфейс   | IP адрес  | Маска подсети |
| ---------- | ------------| ----------| ------------ |
|  S1 | VLAN 99  | 192.168.1.11 | 255.255.255.0 | 
|  S2 | VLAN 99  | 192.168.1.13 | 255.255.255.0 | 
|  S3 | VLAN 99  | 192.168.1.13 | 255.255.255.0 | 
|  PC-A | NIC  | 192.168.0.2 | 255.255.255.0 | 
|  PC-C | NIC  | 192.168.0.3 | 255.255.255.0 | 

| VLAN  | ИМЯ   | 
| ---------- | ------------| 
|  10 | USER  | 
|  99 | Management  | 

[Конфигурация S1](https://github.com/svasornd/otus_network/blob/master/lab03/config/S1_02.md)

[Конфигурация S2](https://github.com/svasornd/otus_network/blob/master/lab03/config/S2_02.md)

[Конфигурация S3](https://github.com/svasornd/otus_network/blob/master/lab03/config/S3_02.md)

### Шаг 1:	Выполните поиск и устранение неполадок в работе коммутатора S1. ###

#### Используйте команду show interfaces trunk, чтобы убедиться в том, что агрегированные каналы работают, как транковые порты. Отображаются ли агрегированные каналы 1 и 2, как транковые порты? ####

Нет, траковыми каналами являются каждый интерфейс в отдельности, а не агрегированный.

#### Используйте команду show etherchannel summary, чтобы убедиться в том, что интерфейсы входят в состав соответствующего агрегированного канала, применен правильный протокол и интерфейсы задействованы. Есть ли в выходных данных сведения о неполадках в работе EtherChannel? В случае обнаружения неполадок запишите их в отведённом ниже месте. #####

Интерфейсы входят в правильные группы, но протокол использет не верный. Администраор выбрал PAgP, а для группы 1 протокол определен - LACP. Оба агрегированных канала Down.

#### Устраните все ошибки, найденные в выходных данных из предыдущих команд show. Запишите команды, используемые для исправления конфигураций. ####

*interface range e0/0-1*

*no channel-group 1 mode active*

*channel-group 1 mode desirable*

*interface port-channel 2*

*switchport mode trunk*

### Шаг 2:	Выполните поиск и устранение неполадок в работе маршрутизатора S2. ###

#### Выполните команду для того, чтобы убедиться, что агрегированные каналы работают в качестве транковых портов. Ниже запишите команду, которую вы использовали. ####

*show interfaces trunk*

#### Есть ли в выходных данных сведения о неполадках в конфигурациях? В случае обнаружения неполадок запишите их в отведённом ниже месте. ####

Траноквым портом работает только PO1, Po3 не указан как транк. И не работает как транковый порт.

#### Выполните команду, чтобы убедиться в том, что интерфейсы настроены в правильном агрегированном канале и настроен соответствующий протокол. Есть ли в выходных данных сведения о неполадках в работе EtherChannel? В случае обнаружения неполадок запишите их в отведённом ниже месте. ####

*show etherchannel summary*

Po3 в состоянии Down, протокол верный - PAgP

#### Устраните все ошибки, найденные в выходных данных из предыдущих команд show. Запишите команды, использованные для исправления настройки. ####

*int range ethernet 0/2-3*

*no shutdown*

*interface port-channel 3*

*no  switchport trunk allowed vlan 1,10,99*

*interface port-channel 1*

*no  switchport trunk allowed vlan 1,10,99*

*switchport mode trunk*

### Шаг 3:	Выполните поиск и устранение неполадок в работе маршрутизатора S3. ###

#### Выполните команду для того, чтобы убедиться, что агрегированные каналы работают в качестве транковых портов.Есть ли в выходных данных сведения о неполадках в конфигурациях? В случае обнаружения неполадок запишите их в отведённом ниже месте. ####

Настроен только 1 транковый порт. Po3.

#### Выполните команду, чтобы убедиться в том, что интерфейсы настроены в правильном агрегированном канале и применен соответствующий протокол. Есть ли в выходных данных сведения о неполадках в работе EtherChannel? В случае обнаружения неполадок запишите их в отведённом ниже месте. ####

Настроен только port-channel 3

#### Устраните все обнаруженные неполадки. Запишите команды, использованные для исправления конфигурации. ####

*interface range e0/0-1*

*switchport trunk encapsulation dot1q*

*switchport mode trunk*

*channel-group 2 mode desirable*

*switchport trunk native vlan 99*

*no shutdown*

*interface port-channel 2*

*switchport trunk encapsulation dot1q*

*switchport trunk native vlan 99*

*switchport mode trunk*

#### Выполните команду для проверки параметров транковой связи. Ниже запишите команду, которую вы использовали. ####

*show interfaces trunk*

#### Выполните команду для проверки правильного функционирования агрегированных каналов. Ниже запишите команду, которую вы использовали. ####

*show etherchannel summary*

### Шаг 4:	Проверка EtherChannel и подключения ###

Проверьте подключение сети VLAN Management.

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S2? Да

Успешно ли выполняется эхо-запрос от коммутатора S1 на коммутатор S3? Да

Успешно ли выполняется эхо-запрос от коммутатора S2 на коммутатор S3? Да

Проверьте подключения компьютеров.

Успешно ли выполняется эхо-запрос от узла ПК A на узел ПК C? Да

